import React, { useState, useEffect } from "react"





const TabelGenerator = () => {

    let currentDate = new Date().toISOString().split('T')[0]
    //  in tabledata en de code t/m regel 14 pakt de API en vewerkt het in een object
    // tabledata = [{"fundId":1,"fundName":"ASN Duurzaam Aandelenfonds","prices":{"2025-02-17":175.33,"2025-02-14":177.34,"2025-02-13":175.43,"2025-02-12":176.8,"2025-02-11":177.59,"2025-02-10":176.05,"2025-02-07":177.01,"2025-02-06":175.6,"2025-02-05":174.08,"2025-02-04":174.79,"2025-02-03":176.14,"2025-01-31":176.7,"2025-01-30":174.76,"2025-01-29":174.64,"2025-01-28":173.03,"2025-01-27":175.03,"2025-01-24":176.21,"2025-01-23":176.84,"2025-01-22":175.71,"2025-01-21":174.55,"2025-01-20":174.76,"2025-01-17":174.03,"2025-01-16":172.76,"2025-01-15":170.66,"2025-01-14":171.84,"2025-01-13":172.66,"2025-01-10":173.81,"2025-01-09":173.75,"2025-01-08":173.19,"2025-01-07":172.96,"2025-01-06":172.46,"2025-01-03":172.43,"2025-01-02":171.14,"2024-12-31":170.71,"2024-12-30":171.63,"2024-12-27":171.89,"2024-12-24":171.28,"2024-12-23":170.65,"2024-12-20":171.06,"2024-12-19":172.81,"2024-12-18":174.23,"2024-12-17":174.85,"2024-12-16":174.51,"2024-12-13":175.87,"2024-12-12":175.85,"2024-12-11":175.15,"2024-12-10":175.49,"2024-12-09":176.1,"2024-12-06":175.7,"2024-12-05":176.74,"2024-12-04":175.96,"2024-12-03":175.46,"2024-12-02":173.69,"2024-11-29":172.82,"2024-11-28":172.22,"2024-11-27":173.78,"2024-11-26":174.71,"2024-11-25":175.13,"2024-11-22":171.54,"2024-11-21":170.05,"2024-11-20":169.32,"2024-11-19":169.04,"2024-11-18":169.85,"2024-11-15":172.26,"2024-11-14":171.89,"2024-11-13":172.55,"2024-11-12":174.81,"2024-11-11":172.54,"2024-11-08":172.4,"2024-11-07":171.74,"2024-11-06":170.35,"2024-11-05":169.76,"2024-11-04":170.14,"2024-11-01":168.87,"2024-10-31":170.88,"2024-10-30":172.82,"2024-10-29":173.44,"2024-10-28":172.51,"2024-10-25":172.81,"2024-10-24":172.16,"2024-10-23":173.61,"2024-10-22":174.7,"2024-10-21":175.28,"2024-10-18":175.24,"2024-10-17":174.53,"2024-10-16":176.05,"2024-10-15":177.07,"2024-10-14":175.44,"2024-10-11":174.87,"2024-10-10":174.97,"2024-10-09":173.42,"2024-10-08":172.98,"2024-10-07":172.98,"2024-10-04":172.83,"2024-10-03":173.35,"2024-10-02":173.84,"2024-10-01":174.08,"2024-09-30":175.62,"2024-09-27":174.98,"2024-09-26":173.17,"2024-09-25":173.14,"2024-09-24":172.8,"2024-09-23":172.05,"2024-09-20":173.43,"2024-09-19":171.36,"2024-09-18":172.57,"2024-09-17":173.16,"2024-09-16":172.88,"2024-09-13":171.94,"2024-09-12":170.8,"2024-09-11":169.83,"2024-09-10":169.85,"2024-09-09":168.55,"2024-09-06":170.04,"2024-09-05":171.05,"2024-09-04":173.5}}]
    const [tabledata, setTabledata] = useState([])
    useEffect(() => {
        const fetchData = async () => {
            // in apiResponse kan je de string aanpssen om meer data te verwerken. je moet bij funds=1 kan je cijfers invoegen. als je funds=1,2,3,4 dan zie je de volledige API
            const apiResponse = await fetch(`https://asn-tracker.paulvandenburg.nl/api/fund-prices?funds=1&date_from=2024-09-01&date_to=${currentDate}`)
            const JsonData = await apiResponse.json()
            setTabledata(JsonData)
        }
        fetchData()

    })

    const key = "prices"
    //de array is om de plaatsing van de datums te zien van priceKeys
    //priceKeys = [2025-02-17,2025-02-14,2025-02-13,2025-02-12,2025-02-11,2025-02-10,2025-02-07,2025-02-06,2025-02-05,2025-02-04,2025-02-03,2025-01-31,2025-01-30,2025-01-29,2025-01-28,2025-01-27,2025-01-24,2025-01-23,2025-01-22,2025-01-21,2025-01-20,2025-01-17,2025-01-16,2025-01-15,2025-01-14,2025-01-13,2025-01-10,2025-01-09,2025-01-08,2025-01-07,2025-01-06,2025-01-03,2025-01-02,2024-12-31,2024-12-30,2024-12-27,2024-12-24,2024-12-23,2024-12-20,2024-12-19,2024-12-18,2024-12-17,2024-12-16,2024-12-13,2024-12-12,2024-12-11,2024-12-10,2024-12-09,2024-12-06,2024-12-05,2024-12-04,2024-12-03,2024-12-02,2024-11-29,2024-11-28,2024-11-27,2024-11-26,2024-11-25,2024-11-22,2024-11-21,2024-11-20,2024-11-19,2024-11-18,2024-11-15,2024-11-14,2024-11-13,2024-11-12,2024-11-11,2024-11-08,2024-11-07,2024-11-06,2024-11-05,2024-11-04,2024-11-01,2024-10-31,2024-10-30,2024-10-29,2024-10-28,2024-10-25,2024-10-24,2024-10-23,2024-10-22,2024-10-21,2024-10-18,2024-10-17,2024-10-16,2024-10-15,2024-10-14,2024-10-11,2024-10-10,2024-10-09,2024-10-08,2024-10-07,2024-10-04,2024-10-03,2024-10-02,2024-10-01,2024-09-30,2024-09-27,2024-09-26,2024-09-25,2024-09-24,2024-09-23,2024-09-20,2024-09-19,2024-09-18,2024-09-17,2024-09-16,2024-09-13,2024-09-12,2024-09-11,2024-09-10,2024-09-09,2024-09-06,2024-09-05,2024-09-04]
    const priceKeys = Object.keys(tabledata[0][key])
    const priceArrey = []
    const rendementArrey = []
    const datumArrey = []
    //LET OP deze for loop zet de datums in omgekeerde volgorde
    for (let i = priceKeys.length - 1; i >= 0; i--) {
         const key_price = priceKeys[i]
         datumArrey.push(priceKeys[i])
         const workTable = tabledata[0][key][key_price]
         //[173.5,171.05,170.04,168.55,169.85,169.83,170.8,171.94,172.88,173.16,172.57,171.36,173.43,172.05,172.8,173.14,173.17,174.98,175.62,174.08,173.84,173.35,172.83,172.98,172.98,173.42,174.97,174.87,175.44,177.07,176.05,174.53,175.24,175.28,174.7,173.61,172.16,172.81,172.51,173.44,172.82,170.88,168.87,170.14,169.76,170.35,171.74,172.4,172.54,174.81,172.55,171.89,172.26,169.85,169.04,169.32,170.05,171.54,175.13,174.71,173.78,172.22,172.82,173.69,175.46,175.96,176.74,175.7,176.1,175.49,175.15,175.85,175.87,174.51,174.85,174.23,172.81,171.06,170.65,171.28,171.89,171.63,170.71,171.14,172.43,172.46,172.96,173.19,173.75,173.81,172.66,171.84,170.66,172.76,174.03,174.76,174.55,175.71,176.84,176.21,175.03,173.03,174.64,174.76,176.7,176.14,174.79,174.08,175.6,177.01,176.05,177.59,176.8,175.43,177.34,175.33]
         // dit is de priceArrey na de for loop
        priceArrey.push(workTable)
    }

    for (let x = 1; x < priceArrey.length; x++) {
        const rendement = (priceArrey[x] - priceArrey[x-1]).toFixed(2)
        rendementArrey.push(rendement)
        //Dit is hoe de rendementArray er uit ziet na de loop. NOTE alle waardes zijn in string let daar op
        //rendementArray = [-2.45,-1.01,-1.49,1.30,-0.02,0.97,1.14,0.94,0.28,-0.59,-1.21,2.07,-1.38,0.75,0.34,0.03,1.81,0.64,-1.54,-0.24,-0.49,-0.52,0.15,0.00,0.44,1.55,-0.10,0.57,1.63,-1.02,-1.52,0.71,0.04,-0.58,-1.09,-1.45,0.65,-0.30,0.93,-0.62,-1.94,-2.01,1.27,-0.38,0.59,1.39,0.66,0.14,2.27,-2.26,-0.66,0.37,-2.41,-0.81,0.28,0.73,1.49,3.59,-0.42,-0.93,-1.56,0.60,0.87,1.77,0.50,0.78,-1.04,0.40,-0.61,-0.34,0.70,0.02,-1.36,0.34,-0.62,-1.42,-1.75,-0.41,0.63,0.61,-0.26,-0.92,0.43,1.29,0.03,0.50,0.23,0.56,0.06,-1.15,-0.82,-1.18,2.10,1.27,0.73,-0.21,1.16,1.13,-0.63,-1.18,-2.00,1.61,0.12,1.94,-0.56,-1.35,-0.71,1.52,1.41,-0.96,1.54,-0.79,-1.37,1.91,-2.01]
    }

    console.log(priceArrey)
    return (
        <div>
            <p>{JSON.stringify(tabledata)}</p>
            <h1>{`${priceArrey}`}</h1>
            <h2>{`${priceKeys}`}</h2>
            <h3>{rendementArrey}</h3>
            <h4>{`${datumArrey}`}</h4>
        </div>
    )
}

export default TabelGenerator